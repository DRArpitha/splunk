
try{i18n_register({"catalog":{"+-getParam: Splunk cannot get param; null key name passed":"getParam: Splunk cannot get param; null key name passed"},"plural":function(n){return n==1?0:1;}});
Splunk.Module=$.klass({
CURRENT_VIEWSTATE_KEY:'_current',
HIDDEN_MODULE_KEY:'hidden module',
_childModulesHaveFreshContexts:true,
_state:Splunk.util.moduleLoadStates["WAITING_FOR_INITIALIZATION"],
initialize:function(container){
this.logger=Splunk.Logger.getLogger("AbstractModule.js");
if(this.parent||this.container||this._children){
this.logger.error(this.moduleType,".initialize - Assertion Failed. Modules may not be reinitialized.");}
this.container=$(container);
this.resultsContainer=$('<div/>').appendTo(this.container);
this.parent=null;
this._children=[];
this.childEnforcement=0;
this.parentEnforcement=0;
this.baseContext=null;
this._paramsToUseAsSettings=[];
this._lastSuccessfulDispatchedContext=null;
this._previousResultParams=null;
this.moduleId=this.container.attr('id');
this._invisibilityModes={};
this.importParams();
this.getResultsRetryCounter=0;
this.getResultsRetryPolicy=3;
this.getResultsXHRObject=null;
this.pushContextWhenReady=false;
$(document).bind('viewDataChange',this.onViewDataChange.bind(this));
$(document).bind('moduleLoadStatusChange',function(event,module,statusInt){
if(module.moduleId==this.moduleId){
this.onLoadStatusChange(statusInt);}}.bind(this));},
getLoadState:function(){
return this._state;},
setLoadState:function(statusInt,suppressEvent){
var oldState=this._state;
if(oldState!=statusInt){
this._state=statusInt;
if(!suppressEvent){
$(document).trigger('moduleLoadStatusChange',[this,statusInt]);}}},
markPageLoadComplete:function(){
this._pageLoadComplete=true;},
isPageLoadComplete:function(){
return this._pageLoadComplete||false;},
requiresAsynchronousLoading:function(){return false;},
onLoadStatusChange:function(statusInt){
if(!this._hierarchyValidated&&(statusInt>=Splunk.util.moduleLoadStates.WAITING_FOR_CONTEXT)){
this.validateHierarchy();}},
mergeLoadParamsIntoContext:function(namespace,paramNames){
for(var i=0;i<paramNames.length;i++){
var pair={namespace:namespace,param:paramNames[i]};
this._paramsToUseAsSettings.push(pair);}},
requiresDispatch:function(search){return false;},
onContextChange:function(){},
_fireDispatch:function(search){
if(!search){
this.logger.error("Assertion failed.  required arg 'search' not passed to ",this.moduleType,"._fireDispatch");
return;}
if(this.dispatchAlreadyInProgress){
return false;}else{
this.dispatchAlreadyInProgress=true;
var USE_AUTOMATIC_STRING_REPLACEMENT=false;
if(USE_AUTOMATIC_STRING_REPLACEMENT){
var context=this.getContext();
var baseSearch=search.toString();
var tokens=Splunk.util.discoverReplacementTokens(baseSearch);
for(var i=0;i<tokens.length;i++){
var replacer=new RegExp("\\$"+tokens[i]+"\\$");
baseSearch=Splunk.util.replaceTokens(baseSearch,replacer,context.get(tokens[i]));
search.setBaseSearch(baseSearch);}}
search.dispatchJob(this._fireDispatchSuccessHandler.bind(this),this._fireDispatchFailHandler.bind(this),this.getGroupName());}},
_removeLastSearch:function(){
var lastSearch=this._lastSuccessfulDispatchedSearch;
if(lastSearch&&lastSearch.isJobDispatched()&&!lastSearch.job.canBeAutoCancelled()){
Splunk.Globals['Jobber'].removeJob(lastSearch.job.getSearchId());}else if(lastSearch&&lastSearch.isJobDispatched()&&lastSearch.job.canBeAutoCancelled()){
lastSearch.job.cancel();}},
_fireDispatchSuccessHandler:function(dispatchedSearch){
this.logger.debug("success - context dispatched for search=",dispatchedSearch.toString());
var context=this.getModifiedContext();
context.set("search",dispatchedSearch);
this.withEachDescendant(function(module){
module.reset();});
this.pushContextToChildren(context);
this._removeLastSearch();
this._lastSuccessfulDispatchedSearch=dispatchedSearch;
this.dispatchAlreadyInProgress=false;},
_fireDispatchFailHandler:function(failedSearch){
this.dispatchAlreadyInProgress=false;
this.logger.error(this.moduleType," Context failed to dispatch job for search=",failedSearch.toString());
this._removeLastSearch();
var descendants=this.getDescendants();
for(var i=0,len=descendants.length;i<len;i++){
descendants[i].reset();}},
someChildrenRequireDispatch:function(search){
var requireDispatch=false;
this.withEachChild(function(child){
if(child.requiresDispatch(search)){
requireDispatch=true;
return false;}});
return requireDispatch;},
onBeforeJobDispatched:function(search){},
ensureFreshContexts:function(){
if(this.getContext().get('search').isJobDispatched()){
return;}
var stale=null;
this.withEachAncestor(function(module){
if(module.getContext().get('search').isJobDispatched()){
return false;}
if(!module._childModulesHaveFreshContexts){
stale=module;}},true);
if(stale){
stale.withEachDescendant(function(child){
child.baseContext=null;});
stale.setChildContextFreshness(true);}},
setChildContextFreshness:function(bool){
this._childModulesHaveFreshContexts=(!!bool);},
getContext:function(){
var context=null;
if(this.baseContext){
context=this.baseContext.clone();}else{
if(this.parent){
var baseContext=this.parent.getModifiedContext();
if(baseContext!=null){
if(this.getLoadState()<Splunk.util.moduleLoadStates.HAS_CONTEXT){
this.logger.debug(this.moduleType+" - Although we're still loading the page we have to let modules cache contexts.");
this.parent.setChildContextFreshness(false);}
this.baseContext=baseContext;
context=baseContext.clone();}else{
var exception_msg=sprintf("getContext was called by %(moduleId)s with no baseContext. %(moduleId)s's parent returned a null context. This should not happen.",this);
throw(exception_msg);}}else{
context=new Splunk.Context();
var search=new Splunk.Search();
context.set("search",search);}}
for(var i=0,len=this._paramsToUseAsSettings.length;i<len;i++){
var pair=this._paramsToUseAsSettings[i];
var namespacedKey=pair.namespace+"."+pair.param;
if(this.getParam(pair.param)!=null&&!context.has(namespacedKey)){
context.set(namespacedKey,this.getParam(pair.param));}}
return context;},
pushContextToChildren:function(explicitContext){
var readiness=this.isReadyForContextPush()
if(readiness==Splunk.Module.CANCEL){
if(!this.isPageLoadComplete()){
var propagateLoadCompleteFlag=function(module){
module.markPageLoadComplete();
module.withEachChild(function(child){
propagateLoadCompleteFlag(child);});};
propagateLoadCompleteFlag(this);}
return;}else if(readiness==Splunk.Module.DEFER){
this.pushContextWhenReady=true;
return;}else if(readiness==Splunk.Module.CONTINUE){
if(this.pushContextWhenReady){
this.pushContextWhenReady=false;}}else{
this.logger.error(this.moduleType+" returned illegal value from isReadyForContextPush");}
this.ensureFreshContexts();
var childContext=explicitContext||this.getModifiedContext();
if(childContext==null||!childContext.has("search")){
this.logger.warn(this.moduleType,'TODO  - hit old behaviour of returning NULL - getModifiedContext returns a context with a "null" search, stopping the pushContextToChildren call.');
return;}else if(this.getLoadState()<Splunk.util.moduleLoadStates.HAS_CONTEXT){
return;}
this.withEachDescendant(function(module){
module.setLoadState(Splunk.util.moduleLoadStates.WAITING_FOR_CONTEXT);});
var search=childContext.get("search");
if(this.someChildrenRequireDispatch(search)){
search.abandonJob();
this.withEachDescendant(function(module){
module.onBeforeJobDispatched(search);});
this._fireDispatch(search);
return;}
this.withEachChild(function(child){
child.baseContext=childContext;
child.setLoadState(Splunk.util.moduleLoadStates.HAS_CONTEXT);
child.onContextChange();
child.pushContextToChildren();
if(!child.isPageLoadComplete()){
child.markPageLoadComplete();}});
this.setChildContextFreshness(true);},
isReadyForContextPush:function(){
if(this.getLoadState()<Splunk.util.moduleLoadStates.HAS_CONTEXT)return false;
return true},
resetContext:function(){
if(this.baseContext&&this.baseContext.has("search")){
var search=this.baseContext.get("search");
if(search.isJobDispatched()){
Splunk.Globals['Jobber'].removeJob(search.job.getSearchId());}}
this.baseContext=null;
this._lastSuccessfulDispatchedSearch=null;},
getModifiedContext:function(){
if(!this.baseContext){
this.logger.debug(this.moduleType,"does not override getModifiedContext, has no local cache and thus is backfilling");}
return this.getContext();},
applyContext:function(context){
if(!this.isPageLoadComplete()){
this.logger.warn(this.moduleType," does not implement applyContext");}},
passContextToParent:function(context){
if(this.parent){
if(!this.isPageLoadComplete()){
this.parent.applyContext(context)
this.parent.passContextToParent(context);}
else if(!this.parent.applyContext(context)){
return this.parent.passContextToParent(context);}}else if(!this.isPageLoadComplete()){
var newBaseContext=context.clone();
var topSearch=newBaseContext.get("search");
newBaseContext.set("search",topSearch);
this.baseContext=newBaseContext;
return;}
this.logger.warn("an upstream interaction made it to the top of the tree (to ",this.moduleType,") because none of its downstream modules were able to take any action.")
return false;},
addChild:function(child){
if(child.parent){
this.logger.error(this.moduleType,".addChild - Assertion failed. this",child.moduleType," instance already has a parentModule. There Can Be Only One.");}
this._children.push(child);
child.parent=this;},
removeChild:function(childModule){
var newChildrenList=[];
for(var i=0;i<this._children.length;i++){
if(childModule==this._children[i]){
this._children[i].parent=null;}else{
newChildrenList.push(this._children[i]);}}
this._children=newChildrenList;},
validateHierarchy:function(){
this._hierarchyValidated=true;
var msg=false;
if(this.childEnforcement==Splunk.Module.ALWAYS_REQUIRE&&this._children.length==0){
msg="This view has a %s module but it is configured with no child modules to push its changes to. This represents a configuration error.";}else if(this.childEnforcement==Splunk.Module.NEVER_ALLOW&&this._children.length>0){
msg="This view has a %s module configured to push changes to downstream modules. This module never has any changes to push so this represents a configuration error."}
if(this.parentEnforcement==Splunk.Module.ALWAYS_REQUIRE&&!this.parent){
msg="This view has a %s module but that module has no parent modules to receive changes from. This module will not work in this configuration so this represents a configuration error.";}else if(this.parentEnforcement==Splunk.Module.NEVER_ALLOW&&this.parent){
msg="This view has a %s module but that module receives changes from other modules upstream. Since this module will ignore all such changes, this represents a configuration error.";}
if(msg){
if($("div.Message").length>0){
var messenger=Splunk.Messenger.System.getInstance();
messenger.send('error','splunk',_(sprintf(msg,this.moduleType)));}else{
this.displayInlineErrorMessage(_(sprintf(msg,this.moduleType)));}}},
withEachAncestor:function(fn,reverse){
var ancestors=this.getAncestors();
if(reverse)ancestors.reverse();
for(var i=0,j=ancestors.length;i<j;i++){
var resp=fn(ancestors[i]);
if(resp===false)return false;}
return true;},
withEachChild:function(fn){
var children=this._children;
for(var i=0,j=children.length;i<j;i++){
var resp=fn(children[i]);
if(resp===false)return false;}
return true;},
withEachDescendant:function(fn){
this.withEachChild(function(child){
if(fn(child)===false)return false;
child.withEachDescendant(fn);});
return true;},
getRootAncestor:function(){
var pointer=this,resp=null;
while(pointer){
resp=pointer;
pointer=pointer.parent;}
return resp;},
getAncestors:function(){
var pointer=this.parent,resp=[];
while(pointer){
resp.unshift(pointer);
pointer=pointer.parent;}
return resp;},
getGroupName:function(){
if(this._params.hasOwnProperty("group")){
return this._params["group"]}
return(this.parent)?this.parent.getGroupName():false;},
getDescendants:function(){
var resp=this._children.slice();
for(var i=0;i<resp.length;i++){
resp=resp.concat(resp[i]._children);}
return resp;},
getModulesInTree:function(){
var root=this.getRootAncestor();
return[root].concat(root.getDescendants());},
show:function(invisibilityMode){
invisibilityMode=invisibilityMode||"global";
if(this._invisibilityModes.hasOwnProperty(invisibilityMode)){
delete this._invisibilityModes[invisibilityMode];}
this._changeVisibility();},
hide:function(invisibilityMode){
invisibilityMode=invisibilityMode||"global";
this._invisibilityModes[invisibilityMode]=1;
this._changeVisibility();},
showDescendants:function(invisibilityMode){
if(!this.isSwitcherLeaf){
for(var i=0;i<this._children.length;i++){
this._children[i].show(invisibilityMode);
this._children[i].showDescendants(invisibilityMode);}}},
hideDescendants:function(invisibilityMode){
if(!this.isSwitcherLeaf){
for(var i=0,len=this._children.length;i<len;i++){
this._children[i].hide(invisibilityMode);
this._children[i].hideDescendants(invisibilityMode);}}},
_changeVisibility:function(){
var visible=true;
for(var mode in this._invisibilityModes){
if(this._invisibilityModes.hasOwnProperty(mode)){
visible=false;}}
if(visible)this.container.show();
else this.container.hide();},
onViewDataChange:function(event,data){},
pushViewDataChange:function(){
Splunk.Globals.ModuleLoader.refreshViewData();},
importParams:function(){
this._params={};
this._stickyParamList=[];
this._persistableParamList=[];
if(!Splunk.Module.loadParams){
this.logger.info('importParams - view does not have any parameters defined');
return;}
if(Splunk.Module.loadParams.hasOwnProperty(this.moduleId)){
this._params=$.extend(true,{},Splunk.Module.loadParams[this.moduleId]);}
if(!Splunk.Module.paramConfig){
this.logger.info('importParams - view does not have parameter config defined');
return;}
if(Splunk.Module.paramConfig.sticky.hasOwnProperty(this.moduleId)){
this._stickyParamList=Splunk.Module.paramConfig.sticky[this.moduleId];}
if(Splunk.Module.paramConfig.persistable.hasOwnProperty(this.moduleId)){
this._persistableParamList=Splunk.Module.paramConfig.persistable[this.moduleId];}},
getParam:function(key,fallbackValue){
if(!key){
throw Error(_('getParam: Splunk cannot get param; null key name passed'));}
if(this._params.hasOwnProperty(key)){
return this._params[key];}else if(fallbackValue!=null){
return fallbackValue;}else{
return null;}},
setParam:function(key,value,isSessionOnly){
this._params[key]=value;
if(this.getContext().get("viewStateId")){
this.logger.debug('setParam - skipping param write; inside viewstate');
return;}
if($.inArray(key,this._stickyParamList)==-1&&!this._matchesWildcardParam(key)){
this.logger.info('setParam - skipping param write: "'+key+'" is not sticky');
return;}
if(!isSessionOnly){
if(!(typeof(value)=='string')&&!(typeof(value)=='boolean')&&isNaN(value)){
this.logger.debug('setParam - Cannot persist non-primitive value: key='
+key+' type='+typeof(value));
return;}
$.ajax({
type:'POST',
url:this._buildParamUri(),
data:this._buildParamName(key)+'='+encodeURIComponent(value),
dataType:'json',
success:this._setParamCallback.bind(this),
error:this._setParamErrorback.bind(this)});}},
snapshotParamset:function(){
var output={};
var value=null;
var wildcardPrefixes=this._getWildcardPrefixes();
for(var key in this._params){
if((this._params.hasOwnProperty(key)&&$.inArray(key,this._persistableParamList)>-1)||this._matchesWildcardParam(key))
{
value=this._params[key];
if(!(typeof(value)=='string')&&!(typeof(value)=='boolean')&&isNaN(value)){
this.logger.warn('snapshotParamset - Cannot persist non-primitive value: key='
+key+' type='+typeof(value));
continue;}
output[key]=this._params[key];}}
return output;},
_getWildcardPrefixes:function(){
var wildcardPrefixes={};
for(var i=0,L=this._persistableParamList.length;i<L;i++){
var paramName=this._persistableParamList[i];
if(paramName.substring(paramName.length-1)=="*"){
wildcardPrefixes[paramName.substring(0,paramName.length-1)]=1;}}
return wildcardPrefixes;},
_matchesWildcardParam:function(key,forceRefresh){
if(!this.hasOwnProperty('_wildcardPrefixes')){
this._wildcardPrefixes=this._getWildcardPrefixes();}
for(var prefix in this._wildcardPrefixes){
if(key.substring(0,prefix.length)==prefix&&this._wildcardPrefixes.hasOwnProperty(prefix)){
return prefix+'*';}}
return false;},
_setParamCallback:function(data,textStatus){
this.logger.debug('_setParamCallback - response: '+data);},
_setParamErrorback:function(xhr,status,error){
this.logger.error('_setParamCallback - error: '+xhr.responseText);},
_buildParamUri:function(viewstate_id){
viewstate_id=viewstate_id||'_current';
return Splunk.util.make_url('app',
Splunk.util.getCurrentApp(),
Splunk.util.getCurrentView(),
viewstate_id);},
_buildParamName:function(key){
if(key==null){
throw Error('_buildParamName - Cannot build name; null key');}
return encodeURIComponent(this.moduleId+'.'+key);},
getResultURL:function(params){
var uri=Splunk.util.make_url('module',Splunk.util.getConfigValue('SYSTEM_NAMESPACE'),this.moduleType,'render');
params=params||{};
if(!params.hasOwnProperty('client_app')){
params['client_app']=Splunk.util.getCurrentApp();}
uri+='?'+Splunk.util.propToQueryString(params);
return uri;},
getResultParams:function(){
return{};},
resetXHRStatus:function(){
this.getResultsXHRObject=null;
this.getResultsRetryCounter=0;},
getResultsErrorHandler:function(xhr,textStatus,errorThrown){
this.resetXHRStatus();
if(textStatus=='abort'){
this.logger.debug(this.moduleType,'.getResults() aborted');}else{
this.logger.warn(this.moduleType,'.getResults() error; textStatus='+textStatus+' errorThrown='+errorThrown);}},
getResultsCompleteHandler:function(xhr,textStatus){
this.resetXHRStatus();},
getResults:function(){
if(this.getResultsXHRObject){
if(this.getResultsXHRObject.readyState<4){
var job=this.getContext().get("search").job;
if(job&&!job.isDone()&&this.getResultsRetryCounter<this.getResultsRetryPolicy){
this.getResultsRetryCounter++;
this.logger.info('XHR already in-flight for module',this.moduleId,'attempt',this.getResultsRetryCounter,'of',this.getResultsRetryPolicy,'exit out');
return;}else{
this.abortGetResults();
this.resetXHRStatus();
this.logger.info('XHR in-flight destroyed for module',this.moduleId,'for job',job.getSearchId(),'and replaced with new one');}}else{
this.resetXHRStatus();}}
this.logger.info('XHR clear for takeoff for module',this.moduleId);
var params=this.getResultParams();
this._previousResultParams=$.extend(true,{},params);
if(Splunk._testHarnessMode){
this.logger.debug(this.moduleType,".getResults -- we are in _testHarnessMode. If you're not running unit tests right now, something is horribly wrong.")
return false;}
var resultUrl=this.getResultURL(params);
if(!resultUrl){
this.logger.warn("getResultsURL() appears to be unimplemented or returning null for this instance.");}
var callingModule=this.moduleType;
this.getResultsXHRObject=$.ajax({
type:"GET",
cache:($.browser.msie?false:true),
url:resultUrl,
beforeSend:function(xhr){
xhr.setRequestHeader('X-Splunk-Module',callingModule);},
success:function(htmlFragment,textStatus,xhr){
if(params["sid"]){
var job=this.getContext().get("search").job;
if(job&&(params["sid"]!=job.getSearchId())){
this.logger.warn(this.moduleType,"while a request to a particular sid was in-flight, it appears the sid changed underneath us. We are dropping the response and NOT calling renderResults. old sid is",params["sid"]," and the new sid is ",job.getSearchId());
return;}}
if(xhr.status==0){
return;}
this.renderResults(htmlFragment);
this.resetXHRStatus();}.bind(this),
complete:this.getResultsCompleteHandler.bind(this),
error:this.getResultsErrorHandler.bind(this)});},
haveResultParamsChanged:function(){
var currentResultParams=this.getResultParams();
return(!Splunk.util.objectSimilarity(this._previousResultParams,currentResultParams));},
abortGetResults:function(){
if(this.getResultsXHRObject&&this.getResultsXHRObject.readyState<4){
this.logger.info('Aborting getResults request for',this.moduleType);
this.getResultsXHRObject.abort();}},
renderResults:function(htmlFragment,turbo){
if(!htmlFragment){
this.resultsContainer.html('No content available.');
return;}
if(turbo){
this.resultsContainer=$(Splunk.util.turboInnerHTML(this.resultsContainer[0],htmlFragment));}else{
this.resultsContainer.html(htmlFragment);}
if(this.onResultsRendered){
this.onResultsRendered();}},
reset:function(){
this.abortGetResults();
this.resetXHRStatus();
this.resetContext();
this.resetUI();},
resetUI:function(){
this.logger.warn(this.moduleType,'has not implemented a resetUI method.');},
resizeWidthToParent:function(){
this.container.width(this.container.parent().width());},
displayInlineErrorMessage:function(message){
this.logger.error(message);
var errorDiv=$('div.error',this.container);
if(errorDiv.length==0){
errorDiv=$("<div>").addClass("error").appendTo(this.container);}
errorDiv.text(message);
this.container.show();},
printHierarchy:function(indentation){
if(!indentation)indentation="";
this.logger.debug(indentation,this.moduleType);
for(var i=0;i<this._children.length;i++){
this._children[i].printHierarchy(indentation+"    ");}}});
Splunk.Module.ALWAYS_REQUIRE=1;
Splunk.Module.NEVER_ALLOW=-1;
Splunk.Module.CANCEL=-1;
Splunk.Module.DEFER=0
Splunk.Module.CONTINUE=1;;}catch(e){var err="The module 'Splunk.Module' in the 'search' app has thrown an unexpected error and may not function properly. Contact the app author or disable the app to remove this message. ";if(window.console){window.console.log(err);}$(function(){Splunk.Messenger.System.getInstance().send("error","Splunk.Module",err);});}try{i18n_register({"catalog":{},"plural":function(n){return n==1?0:1;}});
Splunk.Module.DispatchingModule=$.klass(Splunk.Module,{
initialize:function($super,container){
this.logger=Splunk.Logger.getLogger("search_modules.js");
$(document).bind('jobProgress',function(event,progressingJob){
if(!this.baseContext||!this.baseContext.has("search"))return false;
var ourJob=this.baseContext.get("search").job;
if(ourJob.getSearchId()==progressingJob.getSearchId()){
this.onJobProgress(event);}}.bind(this));
$(document).bind('jobDone',function(event,doneJob){
if(!this.baseContext||!this.baseContext.has("search"))return false;
var ourJob=this.baseContext.get("search").job;
if(ourJob.getSearchId()==doneJob.getSearchId()){
this.onJobDone(event);}}.bind(this));
$(document).bind('jobStatusChanged',function(event,sid,status){
if(!this.baseContext||!this.baseContext.has("search"))return false;
var search=this.baseContext.get("search");
if((search.job.getSearchId()==sid)){
this.onJobStatusChange(event,status);}}.bind(this));
$super(container);},
baseContext:false,
requiresTransformedResults:function(){return false},
requiresDispatch:function(search){
search=search||new Splunk.Search();
if(this.requiresTransformedResults()){
var range=search.getTimeRange();
if(range.isSubRangeOfJob()){
return true;}}
try{
return!search.isJobDispatched();}catch(e){
this.logger.error("TypeError ",this.moduleType,".requiresDispatch() was given a null search instance.");
return false;}},
pushContextToChildren:function($super,explicitContext){
var context=explicitContext||this.getModifiedContext();
var search=context.get("search");
if(!search.isJobDispatched()&&this.requiresDispatch(search)){
this.logger.error(this.moduleType,".onContextChange - hit the corner case where a DispatchingModule instance requires dispatch for q=",search.toString(),"timeRange=",search.getTimeRange());
this._fireDispatch(search);}else{
$super(context);}},
onJobProgress:function(event){},
onJobDone:function(event){},
onJobStatusChange:function(event,status){
if(status=='cancel'){
this.reset();}}});
Splunk.Module.DispatchingModule.isAbstract=true;;}catch(e){var err="The module 'Splunk.Module.DispatchingModule' in the 'search' app has thrown an unexpected error and may not function properly. Contact the app author or disable the app to remove this message. ";if(window.console){window.console.log(err);}$(function(){Splunk.Messenger.System.getInstance().send("error","Splunk.Module.DispatchingModule",err);});}try{i18n_register({"catalog":{"+-(No apps available)":"(No apps available)","+-Manage apps...":"Manage apps..."},"plural":function(n){return n==1?0:1;}});
Splunk.Module.AccountBar=$.klass(Splunk.Module,{
MAX_URI_LENGTH_IE:2048,
initialize:function($super,container){
$super(container);
this.childEnforcement=Splunk.Module.NEVER_ALLOW;
this.parentEnforcement=Splunk.Module.NEVER_ALLOW;
var appList=this.getParam('appList')||[{'label':_('(No apps available)'),'uri':'','id':''}];
var launcherApp=this.getParam('launcherApp');
var canInstallApps=this.getParam('canInstallApps');
if(appList.length==0){
this.logger.error('Unable to construct app list; no apps found');}
appList.push({'divider':'splDivider'});
if(launcherApp){
appList.push(launcherApp);}
appList.push({'label':_('Manage apps...'),'uri':Splunk.util.make_url('manager',Splunk.util.getCurrentApp(),'apps','local')});
if(canInstallApps){
appList.push({'label':_('Find more apps...'),'uri':Splunk.util.make_url('manager',Splunk.util.getCurrentApp(),'apps','remote')});}
if($('#applicationsMenuActivator',this.container).length){
var appsMenu=new Splunk.MenuBuilder({
containerDiv:this.container,
menuDict:appList,
activator:$('#applicationsMenuActivator',this.container),
menuClasses:'splMenu-secondary'});}
$('.alerts_opener',container).click(function(){
Splunk.window.openAerts(this.href);
return false;});
$('.job_manager_opener',container).click(function(){
Splunk.window.openJobManager();
return false;});
var self=this;
$('.user_options_opener',container).click(function(){
var path=window.location.href.replace(/https?:\/\/[^\/]+\/[^\/]+/,"");
if(/authentication\/changepassword/.exec(path))
return false;
var redirectUrl=this.href+'&redirect_override='+encodeURIComponent(path);
if($.browser.msie&&redirectUrl.length>self.MAX_URI_LENGTH_IE){
redirectUrl=this.href+'&redirect_override='+encodeURIComponent(path.split("#")[0]);}
window.location=redirectUrl;
return false;});
$('.wall_opener',container).click(function(){
Splunk.Popup.Wall();
return false;});
$('.splIcon-close',container).click(function(){
window.close();
return false;});
var cancelJobsOnLogoClick=Splunk.util.normalizeBoolean(this._params.cancelJobsOnLogoClick);
if(cancelJobsOnLogoClick){
$('.appLogo',container).click(function(event){
var target_uri=$(this).attr("href");
var jobs=Splunk.Globals.Jobber.listJobs(function(job){
return(job.canBeAutoCancelled());});
if(jobs.length>0){
jobs.cancel(function(){
if(target_uri){
document.location=target_uri;
return true;}});
if(target_uri){
event.preventDefault();
return false;}}});}}});;}catch(e){var err="The module 'Splunk.Module.AccountBar' in the 'search' app has thrown an unexpected error and may not function properly. Contact the app author or disable the app to remove this message. ";if(window.console){window.console.log(err);}$(function(){Splunk.Messenger.System.getInstance().send("error","Splunk.Module.AccountBar",err);});}try{i18n_register({"catalog":{},"plural":function(n){return n==1?0:1;}});
Splunk.Module.Message=$.klass(Splunk.Module,{
EXCLUDE_LEVELS:[],
EXTERNAL_LINK_REX:/\[(\!?)(\w+\:\/\/[^\s]+)\s+([^\]]+)\]/g,
INTERNAL_LINK_REX:/\[\[(\!?)([^\|]+)\|([^\]]+)\]\]/g,
TARGET_BLANK_TOKEN_REX:/#~#!#~#/g,
TARGET_SAME_TOKEN_REX:/\s*#~##~#/g,
SERVER_DELETE_RESOURCE:Splunk.util.make_url("/api/messages/delete"),
initialize:function($super,container){
$super(container);
this.logger=Splunk.Logger.getLogger("message.js");
this.displayedMessages=[];
this.allMessages=[];
if(this._params['filter']=="*"){
this.maxQueueSize=20;
this.defaultDisplaySize=3;}else{
this.maxSize=parseInt(this._params['maxSize'],10);
this.defaultDisplaySize=this.maxSize;
this.maxQueueSize=this.maxSize;}
this.selectedDisplaySize=this.defaultDisplaySize;
this.clearOnJobDispatch=Splunk.util.normalizeBoolean(this._params['clearOnJobDispatch']);
this.defaults=this._params['default']||[];
this.filter=this._params['filter'];
this.levels={};
switch((""+this._params['level']).toLowerCase()){
case'*':
this.levels=null;
break;
default:
case'debug':
this.levels['debug']=1;
case'info':
this.levels['info']=1;
case'warn':
this.levels['warn']=1;
case'error':
this.levels['error']=1;
case'fatal':
this.levels['fatal']=1;}
this.list=$(".MessageList",this.container);
var self=this;
$("a.remove",this.container).live('click',function(){
var message_id=$(this).attr("data-id");
if($(this).hasClass("splunkd")){
$.ajax({
type:"POST",
url:self.SERVER_DELETE_RESOURCE,
dataType:"text",
data:"message_id="+message_id,
error:function(){self.onMessageDeleted(message_id);},
success:function(){self.onMessageDeleted(message_id);}});}else{
self.onMessageDeleted(message_id);}
return false;});
$("a.showall",this.container).live('click',function(){
self.onShowAll();});
$("a.hide",this.container).live('click',function(){
self.onHide();});
this.messenger=Splunk.Messenger.System.getInstance();
this.messenger.receive(this.filter,this.unshift.bind(this),undefined,true);
this.sendDefaults();
if(this.clearOnJobDispatch){
$(document).bind('jobDispatched',this.onJobDispatched.bind(this));}},
onServerMessagesError:function(data){
alert("Could not delete message: ");},
clear:function(){
var levels=arguments[0]||[];
var allMessages=[];
this.logger.warn("Clearing messages with the exclusion of levels",levels);
for(var i=0;i<this.allMessages.length;i++){
var message=this.allMessages[i];
if($.inArray(message.level,levels)!=-1){
allMessages.push(message);}}
this.allMessages=allMessages;
this.displayedMessages=this.allMessages.slice(0,this.selectedDisplaySize);
this.list.html(this.getHTMLTransform());
$(document).trigger("messageClear",this.container);},
handleControlMessage:function(message){
switch(message.content){
case'CLEAR':
this.clear();
break;
default:
break;}},
onJobDispatched:function(event,context){
this.clear(this.EXCLUDE_LEVELS);},
getHTMLTransform:function(){
var html=[];
for(var i=0;i<this.displayedMessages.length;i++){
var message=this.displayedMessages[i];
html.push('<li class="message '+message.level+'">');
html.push('<div style="float:left">');
html.push(this.getWikiTranform(message.content));
html.push('</div>');
var myClass='';
if(isNaN(message.id)){
myClass='splunkd';
html.push('<div style="float:right"><a href="#" data-id="'+Splunk.util.escapeHtml(message.id)+'" class="remove '+myClass+'">x</a></div>');}
var dataId=Splunk.util.escapeHtml(message.id||"");
html.push('<div style="clear:both"/>');
html.push('</li>');}
var numhiddenmessages=this.allMessages.length-this.selectedDisplaySize;
if(numhiddenmessages>0){
var content=""+numhiddenmessages+" messages not shown.";
html.push('<li class="info">');
html.push(this.getWikiTranform(content));
html.push('<a href="#" class="showall"> Show all </a>');
html.push('</li>');}
if(this.selectedDisplaySize==this.maxQueueSize&&this.allMessages.length>this.defaultDisplaySize){
html.push('<li class="info"> <a href="#" class="hide">Hide messages</a> </li>');}
return html.join('');},
getWikiTranform:function(str){
var text=Splunk.util.escapeHtml(str);
text=text.replace(this.EXTERNAL_LINK_REX,'<a href="$2" #~#$1#~#>$3</a>');
text=text.replace(this.INTERNAL_LINK_REX,this._generateInternalLink);
text=text.replace(this.TARGET_BLANK_TOKEN_REX,'target="_blank"');
text=text.replace(this.TARGET_SAME_TOKEN_REX,'');
return text;},
_generateInternalLink:function(str,blank_token,url,text){
url=Splunk.util.make_url(url);
return'<a href="'+url+'"#~#'+blank_token+'#~#>'+text+'</a>';},
sendDefaults:function(){
for(var i=0;i<this.defaults.length;i++){
var level=this.defaults[i].level||null;
var content=this.defaults[i].content||null;
var className=this.defaults[i].className||null;
if(level&&content&&className){
this.messenger.send(level,className,content);}else{
this.logger.error("Invalid default settings for entry with level:",level,"content:",content,"className:",className);}}},
onMessageDeleted:function(message_id){
for(var j=0;j<this.allMessages.length;j++){
var id=this.allMessages[j].id;
if(message_id==id){
this.allMessages.splice(j,1);
j--;}}
this.displayedMessages=this.allMessages.slice(0,this.selectedDisplaySize);
this.list.html(this.getHTMLTransform());
$(document).trigger("messageUnshift",this.container);},
onShowAll:function(){
this.selectedDisplaySize=this.maxQueueSize;
this.displayedMessages=this.allMessages.slice(0,this.selectedDisplaySize);
this.list.html(this.getHTMLTransform());
$(document).trigger("messageUnshift",this.container);},
onHide:function(){
this.selectedDisplaySize=this.defaultDisplaySize;
this.displayedMessages=this.allMessages.slice(0,this.selectedDisplaySize);
this.list.html(this.getHTMLTransform());
$(document).trigger("messageUnshift",this.container);},
unshift:function(){
var previousMessages=[].concat(this.allMessages);
for(var i=arguments.length-1;i>-1;i--){
var message=arguments[i];
if(message.control){
this.handleControlMessage(message);
continue;}
if(this.levels&&!(message.level.toLowerCase()in this.levels)){
continue;}
for(var j=0;j<this.allMessages.length;j++){
var content=this.allMessages[j].content;
var level=this.allMessages[j].level;
if(message.content==content&&message.level==level){
this.allMessages.splice(j,1);
j--;}}
this.allMessages=[{level:message.level,content:message.content,id:message.id}].concat(this.allMessages);}
this.allMessages.splice(this.maxQueueSize,this.allMessages.length-this.maxQueueSize);
this.displayedMessages=this.allMessages.slice(0,this.selectedDisplaySize);
if(!Splunk.util.objectSimilarity(previousMessages,this.displayedMessages)){
this.list.html(this.getHTMLTransform());
$(document).trigger("messageUnshift",this.container);}
return $("li",this.list).length;}});;}catch(e){var err="The module 'Splunk.Module.Message' in the 'search' app has thrown an unexpected error and may not function properly. Contact the app author or disable the app to remove this message. ";if(window.console){window.console.log(err);}$(function(){Splunk.Messenger.System.getInstance().send("error","Splunk.Module.Message",err);});}